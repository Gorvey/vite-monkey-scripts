# ğŸ“– æ·»åŠ æ–°è„šæœ¬æŒ‡å—

æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•å‘ `vite-monkey-scripts` é¡¹ç›®ä¸­æ·»åŠ æ–°çš„ç”¨æˆ·è„šæœ¬ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
vite-monkey-scripts/
â”œâ”€â”€ packages/                    # è„šæœ¬åŒ…ç›®å½•
â”‚   â”œâ”€â”€ script-name/            # å•ä¸ªè„šæœ¬ç›®å½•
â”‚   â”‚   â”œâ”€â”€ config.ts           # è„šæœ¬é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.ts            # è„šæœ¬å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ styles/             # æ ·å¼ç›®å½•
â”‚   â”‚   â”‚   â””â”€â”€ styles.ts       # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ components/         # Vueç»„ä»¶ç›®å½•ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â””â”€â”€ types.ts            # ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ project.config.ts           # é¡¹ç›®ä¸»é…ç½®
â”œâ”€â”€ package.json               # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â””â”€â”€ docs/                      # æ–‡æ¡£ç›®å½•
```

## ğŸš€ æ·»åŠ æ–°è„šæœ¬æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»ºè„šæœ¬ç›®å½•

åœ¨ `packages/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è„šæœ¬ç›®å½•ï¼š

```bash
mkdir packages/your-script-name
```

### æ­¥éª¤ 2: åˆ›å»ºé…ç½®æ–‡ä»¶

åˆ›å»º `packages/your-script-name/config.ts`ï¼š

```typescript
import type { MonkeyOption } from 'vite-plugin-monkey'

const config: MonkeyOption = {
  entry: './packages/your-script-name/index.ts',
  userscript: {
    version: '0.0.1',
    'run-at': 'document-idle' as const,
    match: ['https://example.com/*'], // æ›¿æ¢ä¸ºç›®æ ‡ç½‘ç«™
    description: 'æ‚¨çš„è„šæœ¬æè¿°',
    license: 'MIT',
    name: 'your-script-name',
    // å¯é€‰é…ç½®
    require: [
      // 'https://cdn.jsdelivr.net/npm/library@version'
    ],
    grant: [
      // 'GM_addStyle',
      // 'GM_setValue',
      // 'GM_getValue'
    ],
  },
  build: {
    fileName: 'your-script-name.user.js',
  },
}

export default config
```

### æ­¥éª¤ 3: åˆ›å»ºæ ·å¼æ–‡ä»¶

åˆ›å»º `packages/your-script-name/styles/styles.ts`ï¼š

```typescript
GM_addStyle(`
/* æ‚¨çš„CSSæ ·å¼ */
.your-custom-class {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 10000;
  padding: 10px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.your-button {
  background: #007bff;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.your-button:hover {
  background: #0056b3;
}
`)
```

### æ­¥éª¤ 4: åˆ›å»ºä¸»å…¥å£æ–‡ä»¶

åˆ›å»º `packages/your-script-name/index.ts`ï¼š

```typescript
import './styles/styles'

// é…ç½®å¯¹è±¡
const CONFIG = {
  targetSelector: '.target-element',
  buttonClass: 'your-custom-button',
}

// ä¸»ç±»
class YourScriptManager {
  private isInitialized = false

  constructor() {
    this.init()
  }

  private init() {
    if (this.isInitialized) return

    console.log('æ‚¨çš„è„šæœ¬åˆå§‹åŒ–')
    this.createUI()
    this.bindEvents()
    this.isInitialized = true
  }

  private createUI() {
    // åˆ›å»ºUIå…ƒç´ 
    const button = document.createElement('button')
    button.className = CONFIG.buttonClass
    button.textContent = 'ç‚¹å‡»æˆ‘'
    button.title = 'è„šæœ¬åŠŸèƒ½æè¿°'

    document.body.appendChild(button)
  }

  private bindEvents() {
    document.addEventListener('click', (e) => {
      const target = e.target as HTMLElement
      if (target.classList.contains(CONFIG.buttonClass)) {
        this.handleButtonClick()
      }
    })
  }

  private handleButtonClick() {
    console.log('æŒ‰é’®è¢«ç‚¹å‡»äº†')
    // åœ¨è¿™é‡Œå®ç°æ‚¨çš„åŠŸèƒ½é€»è¾‘
  }
}

// åˆå§‹åŒ–è„šæœ¬
new YourScriptManager()
```

### æ­¥éª¤ 5: æ›´æ–°é¡¹ç›®é…ç½®

ç¼–è¾‘ `project.config.ts`ï¼Œæ·»åŠ æ–°è„šæœ¬çš„å¯¼å…¥å’Œé…ç½®ï¼š

```typescript
import codesignCssToTailwind from './packages/codesign-css-to-tailwind/config.ts'
import copyMultiZentaoBugId from './packages/copy-multi-zentao-bug-id/config.ts'
import yourScriptName from './packages/your-script-name/config.ts' // æ–°å¢

export default {
  codesignCssToTailwind,
  copyMultiZentaoBugId,
  yourScriptName, // æ–°å¢
}
```

### æ­¥éª¤ 6: æ›´æ–° package.json

åœ¨ `package.json` çš„ `scripts` éƒ¨åˆ†æ·»åŠ å¼€å‘å’Œæ„å»ºå‘½ä»¤ï¼š

```json
{
  "scripts": {
    "dev:your-script-name": "vite --mode yourScriptName",
    "build:your-script-name": "vite build --mode yourScriptName"
  }
}
```

## ğŸ› ï¸ å¼€å‘å’Œæ„å»º

### å¼€å‘æ¨¡å¼

```bash
pnpm dev:your-script-name
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build:your-script-name
```

### æ„å»ºæ‰€æœ‰è„šæœ¬

```bash
pnpm build
```

## ğŸ“ é…ç½®è¯´æ˜

### userscript é…ç½®é¡¹

| é…ç½®é¡¹        | è¯´æ˜               | ç¤ºä¾‹                                                               |
| ------------- | ------------------ | ------------------------------------------------------------------ |
| `match`       | è„šæœ¬è¿è¡Œçš„ç›®æ ‡ç½‘ç«™ | `['https://example.com/*']`                                        |
| `name`        | è„šæœ¬åç§°           | `'my-awesome-script'`                                              |
| `description` | è„šæœ¬æè¿°           | `'è¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„è„šæœ¬'`                                             |
| `version`     | è„šæœ¬ç‰ˆæœ¬           | `'1.0.0'`                                                          |
| `run-at`      | è„šæœ¬è¿è¡Œæ—¶æœº       | `'document-idle'`                                                  |
| `require`     | å¤–éƒ¨ä¾èµ–åº“         | `['https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js']` |
| `grant`       | æƒé™ç”³è¯·           | `['GM_addStyle', 'GM_setValue']`                                   |

### è¿è¡Œæ—¶æœºé€‰é¡¹

- `document-start`: æ–‡æ¡£å¼€å§‹åŠ è½½æ—¶
- `document-body`: body å…ƒç´ å­˜åœ¨æ—¶
- `document-end`: DOM åŠ è½½å®Œæˆæ—¶
- `document-idle`: é¡µé¢åŠ è½½å®Œæˆåï¼ˆæ¨èï¼‰

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

- è„šæœ¬ç›®å½•ä½¿ç”¨çŸ­æ¨ªçº¿å‘½å: `awesome-script`
- é…ç½® mode ä½¿ç”¨é©¼å³°å‘½å: `awesomeScript`
- CSS ç±»åä½¿ç”¨å‰ç¼€é¿å…å†²çª: `awesome-script-button`

### 2. ä»£ç ç»“æ„

- ä½¿ç”¨ç±»å°è£…è„šæœ¬é€»è¾‘
- åˆ†ç¦»é…ç½®ã€æ ·å¼å’ŒåŠŸèƒ½ä»£ç 
- æ·»åŠ å¿…è¦çš„é”™è¯¯å¤„ç†

### 3. æ ·å¼ç®¡ç†

- ä½¿ç”¨ `GM_addStyle` æ³¨å…¥æ ·å¼
- æ·»åŠ é«˜ z-index ç¡®ä¿ UI æ˜¾ç¤º
- ä½¿ç”¨å“åº”å¼è®¾è®¡é€‚é…ä¸åŒå±å¹•

### 4. æ€§èƒ½ä¼˜åŒ–

- é¿å…åœ¨å¾ªç¯ä¸­æ‰§è¡Œ DOM æ“ä½œ
- ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†åŠ¨æ€å…ƒç´ 
- åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç›‘å¬å™¨

## ğŸ”§ å¸¸ç”¨å·¥å…·å‡½æ•°

é¡¹ç›®æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å·¥å…·å‡½æ•°ï¼Œä½äº `utils/` ç›®å½•ï¼š

- `copyToClipboard.ts`: å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
- `message.ts`: æ˜¾ç¤ºæ¶ˆæ¯æç¤º
- `waitElement.ts`: ç­‰å¾…å…ƒç´ å‡ºç°
- `css-to-tailwind.ts`: CSS è½¬ Tailwind å·¥å…·

ä½¿ç”¨ç¤ºä¾‹ï¼š

```typescript
import { copyToClipboard } from '../../utils/copyToClipboard'
import { message } from '../../utils/message'
import { waitElement } from '../../utils/waitElement'

// å¤åˆ¶æ–‡æœ¬
copyToClipboard('è¦å¤åˆ¶çš„æ–‡æœ¬')

// æ˜¾ç¤ºæ¶ˆæ¯
message.success('æ“ä½œæˆåŠŸ')
message.error('æ“ä½œå¤±è´¥')

// ç­‰å¾…å…ƒç´ 
const element = await waitElement('.target-selector')
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æƒé™ç”³è¯·**: ä½¿ç”¨ `GM_*` API éœ€è¦åœ¨ `grant` ä¸­å£°æ˜
2. **è·¨åŸŸè¯·æ±‚**: éœ€è¦åœ¨ `connect` ä¸­å£°æ˜å…è®¸çš„åŸŸå
3. **æ ·å¼éš”ç¦»**: ä½¿ç”¨ç‰¹å®šçš„ç±»åå‰ç¼€é¿å…æ ·å¼å†²çª
4. **å…¼å®¹æ€§**: ç¡®ä¿ä»£ç åœ¨ç›®æ ‡ç½‘ç«™çš„æµè§ˆå™¨ç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œ
5. **æ€§èƒ½**: é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¤§é‡æ“ä½œè€ƒè™‘ä½¿ç”¨ `requestAnimationFrame`

## ğŸ” è°ƒè¯•æŠ€å·§

1. **å¼€å‘å·¥å…·**: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·è°ƒè¯•
2. **Console æ—¥å¿—**: é€‚å½“æ·»åŠ  `console.log` è·Ÿè¸ªæ‰§è¡Œæµç¨‹
3. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `try-catch` æ•è·å’Œå¤„ç†é”™è¯¯
4. **çƒ­é‡è½½**: å¼€å‘æ¨¡å¼ä¸‹è‡ªåŠ¨é‡è½½ï¼Œæ–¹ä¾¿è°ƒè¯•

## ğŸ“š å‚è€ƒèµ„æº

- [Vite Plugin Monkey æ–‡æ¡£](https://github.com/lisonge/vite-plugin-monkey)
- [Tampermonkey æ–‡æ¡£](https://www.tampermonkey.net/documentation.php)
- [Greasemonkey API](https://wiki.greasespot.net/Greasemonkey_Manual:API)
- [Vue 3 æ–‡æ¡£](https://cn.vuejs.org/)

---

ğŸ‰ æ­å–œï¼æ‚¨å·²ç»å­¦ä¼šäº†å¦‚ä½•å‘é¡¹ç›®ä¸­æ·»åŠ æ–°çš„ç”¨æˆ·è„šæœ¬ã€‚å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ç°æœ‰è„šæœ¬çš„å®ç°ä½œä¸ºå‚è€ƒã€‚
